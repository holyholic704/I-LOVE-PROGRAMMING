# 字段类型

![](./md.assets/field_type.png)

<small>[MySQL常见面试题总结 - MySQL 字段类型](https://javaguide.cn/database/mysql/mysql-questions-01.html)</small>

## 数值类型的 unsigned 属性

数值类型可以使用可选的 unsigned 属性来表示不允许负值的无符号数值，这样可以将可存储的数值的上限提高一倍

## CHAR 与 VARCHAR

- CHAR 是定长类型，长度是固定的，如果长度小于指定的长度，会自动用空格填充；VARCHAR 是变长类型，长度是根据存储的字符串来的
  - `CHAR(10)`：即便只存储 1 个字符，也会占用 10 个字符的空间
  - `VARCHAR(10)`：只存储 1 个字符，也只会占用 1 个字符的空间
- 使用 CHAR 存储长度不一致的字符串，会造成空间的浪费，最好只存储一些长度较短且长度固定的字符串
- VARCHAR 适合存储一些长度不固定的字符串，但在存储时，需要额外使用 1 或 2 个字节记录字符串的长度
- CHAR 类型最多只能存放 255 个字符；而 VARCHAR 最多可以存储 65533 个字节的字符

### `VARCHAR(M)` 最多能存储的数据

MySQL 对一条记录占用的最大存储空间是有限制的，除了 BLOB、TEXT 类型的列之外，其他所有的列（不包括隐藏列和记录头信息）占用的字节长度加起来 **不能超过 65535 个字节**

为了存储一个 `VARCHAR(M)` 类型的列，其实需要占用 3 部分存储空间

1. 真实数据
2. 真实数据占用的字节长度
3. NULL 值标识

所以 `VARCHAR(M)` 最多能存储的字节数为 `65535 - (是否允许 NULL 值 ? 1 : 0) - 2`

- 因为可变字段允许存储的最大字节数超过 255 字节并且真实存储的字节数超过 127 字节，则使用 2 个字节，否则使用 1 个字节

`VARCHAR(M)` 最多能存储的字符数为 65532 ~ 65533，除以字符集中表示一个字符最多需要使用的字节数

## `VARCHAR(100)` 与 `VARCHAR(10)` 的区别

虽然 `VARCHAR(100)` 和 `VARCHAR(10)` 能存储的字符范围不同，但二者存储相同的字符串，所占用磁盘的存储空间其实是一样的

不过 `VARCHAR(100)` 会消耗更多的内存。这是因为 VARCHAR 类型在内存中操作时，会使用固定大小的内存块来保存值，即使用字符类型中定义的长度

## `int(0)` 与 `int(10)`

`int(0)` 与 `int(10)` 跟能存储的数据范围无关，能存储的数据范围使用的类型有关。指定长度能影响的只有显示数据的宽度，即我们能看到的宽度

当我们在数值类型上使用 zerofill 时，会自动为我们将不满足长度的数值上填充 0，这时指定的长度的作用就显现出来了

```sql
# int(0)
999

# int(10)
0000000999
```

## DECIMAL

DECIMAL 是定点数，用于存储具有精度要求的小数，例如与货币相关的数据，可以避免浮点数带来的精度损失

## TEXT 与 BLOB

TEXT 用于存储大字符串，BLOB 用于存储二进制数据

应尽量避免使用这两种类型

- 不能有默认值
- 查询效率低
- 不能直接创建索引，需要指定前缀长度
- 可能会消耗大量的网络和 IO 带宽
- 在使用临时表时无法使用内存临时表，只能在磁盘上创建临时表

## 日期与时间类型

不建议使用字符串存储日期

- 字符串占用的空间更大
- 字符串存储的日期效率比较低（逐个字符进行比对），无法用日期相关的 API 进行计算和比较

### DATETIME 与 TIMESTAMP

- 存储时间的表现格式一致，均为 `YYYY-MM-DD HH:MM:SS`
- 都可以存储微秒的小数秒

#### 时区

- DateTime 与时区无关，保存的时间都是当前会话所设置的时区对应的时间
- Timestamp 和时区有关。保存的时间会随着服务器时区的变化而变化，自动换算成相应的时间

#### 表示范围

- DateTime：`1000-01-01 00:00:00.000000 ~ 9999-12-31 23:59:59.499999`
- Timestamp：`1970-01-01 00:00:01.000000 ~ 2038-01-19 03:14:07.499999`

#### 占用空间

- MySQL 5.6.4 之前，DateTime 和 Timestamp 的存储空间是固定的，分别为 8 字节和 4 字节
- MySQL 5.6.4 之后，它们的存储空间会根据毫秒精度的不同而变化，DateTime 的范围是 5 ~ 8 字节，Timestamp 的范围是 4 ~ 7 字节

### 时间戳

可以使用 int 或者 bigint 类型来保存时间戳，但可读性较差

## NULL 与 `''`

- `''` 的长度是 0，是不占用空间的，而 NULL 需要额外的空间对其进行标记
- NULL 会影响数据分析
  - 使用聚合函数时，NULL 值会被忽略，从而导致结果不准确
  - 进行分组时，NULL 值会被视为独立的一组
  - 使用 `count(1)`、`count(*)` 时会统计所有的记录数，包括 NULL 值
- 查询 NULL 值时，必须使用 IS NULL 或 IS NOT NULLl 来判断，不能使用运算符进行比较。而 `''` 可以使用这些比较运算符的
- NULL 值需要进行判空处理，否则可能会影响代码逻辑，产生空指针问题
- 列中 NULL 值过多会影响索引的查询效率，因为列中的重复值过多，通过索引查出来的结果也就更多，需要大量的回表操作，甚至会直接采用全表扫描而不走索引

## 大字段

通常指的是 TEXT 与 BLOB，也包括一些存储了很多数据的字段，例如非常长的字符串

- 首先大字段肯定影响的就是存储空间，不仅会占用更多的磁盘与内存（缓存），还影响网络 IO
  - 使用对象存储
  - 业务中使用缓存，避免频繁对大字段进行查询
- 增加索引的维护成本，影响查询效率
  - 将大字段拆分成多个字段
  - 建立前缀索引

## 参考

- [MySQL常见面试题总结](https://javaguide.cn/database/mysql/mysql-questions-01.html)
- [MySQL日期类型选择建议](https://javaguide.cn/database/mysql/some-thoughts-on-database-storage-time.html)
- [常见面试题:为什么Mysql不建议使用NULL作为列的默认值](https://www.zytool.cn/read/122)
- [mysql 一张表中有大字段类型,影响性能吗](https://blog.51cto.com/u_16213394/7249939)
