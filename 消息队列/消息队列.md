# 消息队列

## 作用

- 异步：可以将耗时的、不需要立即返回结果的任务使用消息队列进行处理，提高响应效率，如增减库存，批量导入等
- 解耦：降低模块、功能之间的耦合性
- 削峰：减轻服务端压力，将短时间的大量的请求，转为长时间的平滑稳定的请求

## 缺点

- 系统可用性降低：增加消息队列可能导致原本独立的系统之间出现依赖关系，增加了单点故障的风险，导致整体系统可用性的下降。还需考虑消息队列的可用性
- 系统复杂性提高：需要保证消息队列能正确处理消息丢失、重复消费以及顺序性等问题，增加开发的复杂性和成本
- 一致性问题：在分布式系统环境中，消息丢失或者重复消费可能会导致不一致的结果

## 选型

![](./md.assets/mq.png)

<small>[面渣逆袭：RocketMQ二十三问 - 四大消息队列对比](https://mp.weixin.qq.com/s?__biz=MzkwODE5ODM0Ng==&mid=2247490996&idx=1&sn=ba9558574d71979aa689a710c28c7e0e&chksm=c0ccf511f7bb7c07f23d6593e0792cae5dcc9fd003bc4b92f590199b470133ae32fa4025ec39&scene=178&cur_album_id=2041709347461709827#rd)</small>

ActiveMQ 虽然已经非常成熟，但性能较差、版本迭代慢、社区目前也不活跃，基本已经算淘汰了

- 吞吐量：推荐 RocketMQ 与 Kafka
- 响应：RabbitMQ 的响应延迟能达到微秒级，其他都在毫秒级
- 可用性：RocketMQ 与 Kafka 基于分布式架构，相比与 RabbitMQ 的主从架构，可用性更高
- 消息丢失：RabbitMQ 丢失的可能性非常低，RocketMQ 与 Kafka 理论上能做到 0 丢失

## 参考

- [消息队列基础知识总结](https://javaguide.cn/high-performance/message-queue/message-queue.html)
- [面渣逆袭：RocketMQ二十三问](https://mp.weixin.qq.com/s?__biz=MzkwODE5ODM0Ng==&mid=2247490996&idx=1&sn=ba9558574d71979aa689a710c28c7e0e&chksm=c0ccf511f7bb7c07f23d6593e0792cae5dcc9fd003bc4b92f590199b470133ae32fa4025ec39&scene=178&cur_album_id=2041709347461709827#rd)
