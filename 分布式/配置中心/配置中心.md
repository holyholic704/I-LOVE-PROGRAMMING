## 配置中心

微服务下，业务的发展一般会导致服务数量的增加，进而导致程序配置增多，需要引用配置中心治理

- 配置实时生效：传统的静态配置方式要想修改某个配置只能修改之后重新发布，或者通过数据库轮询。通过配置中心可以动态的管理配置，还无需重启
- 配置管理流程：配置的权限管控、灰度发布、版本管理、格式检验和安全配置等一系列的配置管理相关的特性也是配置中心不可缺少的一部分

### 特性

#### 高可用

一旦引入配置中心，配置中心在整个系统中的地位就非常重要了，一旦配置中心不能正常提供服务，就可能会导致项目整体故障，所以必须得配置中心的高可用

#### 配置修改实时生效（热发布）

在配置中心服务修改完配置并发布后，客户端能实时接收到最新的配置，并通知到应用程序

#### 权限管理

配置的修改、发布等操作需要严格的权限控制

#### 统一管理不同环境不同集群的配置

同一个应用在不同的环境、不同的集群、不同的命名空间下经常需要有不同的配置，所以需要有完善的环境、集群、命名空间配置管理

#### 监控

配置的修改、发布等操作需要记录完整的日志，配置在被哪些应用客户端实例使用，以及一个实例使用到了哪些配置都需要记录，以便排查问题或者进行统计

#### 版本管理、回滚

当配置变更不符合预期的时候，需要根据配置的发布版本进行回滚

#### 灰度发布

配置的灰度发布是配置中心比较重要的功能，当配置的变更影响比较大的时候，需要先在部分应用实例中验证配置的变更是否符合预期，然后再推送到所有应用实例

#### 格式校验

应用的配置数据存储在配置中心一般都会以一种配置格式存储，比如 Properties、JSON、YAML 等，如果配置格式错误，会导致客户端解析配置失败引起生产故障，配置中心对配置的格式校验能够有效防止人为错误操作的发生

### 选型

| 功能点 | Apollo | Nacos | Spring Cloud Config |
| :- | :-: | :-: | :-: |
| 配置界面 | 支持 | 支持 | 无（需要通过 Git 操作） |
| 配置实时生效 | 支持(HTTP 长轮询 1s 内) | 支持(HTTP 长轮询 1s 内)  | 重启生效，或手动 refresh 生效 |
| 版本管理 | 支持 | 支持 | 支持（依赖 Git） |
| 权限管理 | 支持 | 支持 | 支持（依赖 Git） |
| 灰度发布 | 支持 | 支持 | 不支持 |
| 配置回滚 | 支持 | 支持 | 支持（依赖 Git） |
| 告警通知 | 支持 | 支持 | 不支持 |
| 多环境 | 支持 | 支持 | 不支持 |
| 监听查询 | 支持 | 支持 | 支持 |

- Nacos 使用起来比较简单，并且还可以直接用来做服务发现及管理；Apollo 只能用来做配置管理，使用相对复杂一些

## 引用

- [Nacos、Apollo、Config配置中心如何选型？这10个维度告诉你！](https://mp.weixin.qq.com/s/o-5_JwfUOElmzJSiMCSxYg)
- [配置中心原理和选型：Disconf、Apollo、Spring Cloud Config 和 Nacos](https://mp.weixin.qq.com/s/1D-X6MyMxZriX7NkYWS5zA)
