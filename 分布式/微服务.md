

## 配置中心

微服务下，业务的发展一般会导致服务数量的增加，进而导致程序配置（服务地址、数据库参数等等）增多，需要引用配置中心治理

配置实时生效：传统的静态配置方式要想修改某个配置只能修改之后重新发布应用，或通过数据库轮询，配置中心专门针对这个业务场景，兼顾实时性和一致性来管理动态配置

配置管理流程：配置的权限管控、灰度发布、版本管理、格式检验和安全配置等一系列的配置管理相关的特性，也是配置中心不可获取的一部分

### 支持功能

- 灰度发布：配置的灰度发布是配置中心比较重要的功能，当配置的变更影响比较大的时候，需要先在部分应用实例中验证配置的变更是否符合预期，然后再推送到所有应用实例
- 权限管理：配置的修改、发布等操作需要严格的权限控制
- 版本管理&回滚：当配置变更不符合预期的时候，需要根据配置的发布版本进行回滚
- 配置格式校验：应用的配置数据存储在配置中心一般都会以一种配置格式存储，比如Properties、Json、Yaml等，如果配置格式错误，会导致客户端解析配置失败引起生产故障，配置中心对配置的格式校验能够有效防止人为错误操作的发生，是配置中心核心功能中的刚需
- 日志记录：配置的修改、发布等操需要记录完整的日志，便于后期排查问题
- 监听查询：当排查问题或者进行统计的时候，需要知道一个配置被哪些应用实例使用到，以及一个实例使用到了哪些配置
- 高可用：配置中心在整个系统中的地位就非常重要了，一旦配置中心不能正常提供服务，就可能会导致项目整体故障，配置中心必须支持高可用
- 配置修改实时生效（热发布）
- 多环境：在实际生产中，配置中心常常需要涉及多环境或者多集群，业务在开发的时候可以将开发环境和生产环境分开，或者根据不同的业务线存在多个生产环境。如果各个环境之间的相互影响比较小（开发环境影响到生产环境稳定性），配置中心可以通过逻辑隔离的方式支持多环境，所以需要有完善的环境、集群、命名空间配置管理

### 选型

| 功能点 | Apollo | Nacos | Spring Cloud Config |
| :- | :-: | :-: | :-: |
| 配置界面 | 支持 | 支持 | 无（需要通过 Git 操作） |
| 配置实时生效 | 支持(HTTP 长轮询 1s 内) | 支持(HTTP 长轮询 1s 内)  | 重启生效，或手动 refresh 生效 |
| 版本管理 | 支持 | 支持 | 支持（依赖 Git） |
| 权限管理 | 支持 | 支持 | 支持（依赖 Git） |
| 灰度发布 | 支持 | 支持（Nacos 1.1.0 版本开始支持灰度配置） | 不支持 |
| 配置回滚 | 支持 | 支持 | 支持（依赖 Git） |
| 告警通知 | 支持 | 支持 | 不支持 |
| 多语言 | 主流语言，Open API | 主流语言，Open API | 只支持 Spring 应用 |
| 多环境 | 支持 | 支持 | 不支持 |
| 监听查询 | 支持 | 支持 | 支持 |

- Nacos 使用起来比较简单，并且还可以直接用来做服务发现及管理。Apollo 只能用来做配置管理，使用相对复杂一些

## 网关

微服务中网关的首要职责就是作为统一的出口对外提供服务，将外部访问网关地址的流量，根据适当的规则路由到内部集群中正确的服务节点之上

微服务中的网关首先应该是个路由器，在满足此前提的基础上，网关还可以根据需要作为流量过滤器来使用，提供某些额外的可选的功能，譬如安全、认证、授权、限流、监控、缓存，等等

实际上，网关主要做了两件事情：请求转发 + 请求过滤

仅从技术实现角度来看，对于路由这项工作，负载均衡器与服务网关在实现上是没有什么差别的，很多服务网关本身就是基于老牌的负载均衡器来实现的

但从目的角度看，负载均衡器与服务网关会有一些区别，具体在于前者是为了根据均衡算法对流量进行平均地路由，后者是为了根据流量中的某种特征进行正确地路由

网关的另一个主要关注点是它的性能与可用性。由于网关是所有服务对外的总出口，是流量必经之地，所以网关的路由性能将导致全局的、系统性的影响

任何系统的网络调用过程中都至少会有一个单点存在，这是由用户只通过唯一的一个地址去访问系统所决定的

由于网关的地址具有唯一性，就不像之前服务发现那些注册中心那样直接做个集群，随便访问哪一台都可以解决问题

## 流量治理

## 引用
